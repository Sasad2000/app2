<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فاتورة مبيعات</title>
    <style>
        /* إعدادات عامة */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #008080, #004d4d);
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
            direction: rtl;
            user-select: none; /* منع تحديد النصوص في جميع الصفحة */
        }

        /* شريط العنوان */
        .header {
            background: #006666;
            text-align: center;
            padding: 0.3rem 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 18px;
            margin: 0;
        }

        /* محتوى الفاتورة */
        .invoice {
            margin: 20px;
            background: #ffffff;
            color: #000;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .invoice h2 {
            margin-bottom: 1rem;
            text-align: center;
            color: #006666;
        }

        /* تخطيط الجدول */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            margin: 20px 0;
        }

        table th, table td {
            padding: 10px;
            text-align: center;
            background: #f9f9f9;
            color: #333;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table th {
            background-color: #006666;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }

        table tbody tr:hover td {
            background: #eaf4f4;
            color: #006666;
            transition: background 0.3s ease;
        }

        table tfoot td {
            font-weight: bold;
            background-color: #e0f7f7;
            color: #006666;
        }

        /* تحديد عرض الأعمدة */
        table th:nth-child(2), table td:nth-child(2) {
            width: 5%; /* عرض عمود العدد */
        }

        table th:nth-child(4), table td:nth-child(4) {
            width: 35%; /* عرض عمود الإجمالي */
        }

        /* شريط المهام */
        .footer {
            background: #004d4d;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
        }

        .footer button {
            margin: 0 10px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            background: linear-gradient(to bottom, #00a6a6, #007d7d);
            border: none;
            border-radius: 5px;
            box-shadow: 0 3px #004d4d;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .footer button:active {
            transform: translateY(2px);
            box-shadow: 0 1px #004d4d;
        }

        /* الرسائل المنبثقة */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: #fff;
            color: #000;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: popupAnim 0.3s ease-in-out forwards;
        }

        .popup h3 {
            margin: 0;
            font-size: 18px;
        }

        .popup button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #008080;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px #004d4d;
        }

        .popup button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #004d4d;
        }

        @keyframes popupAnim {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* لإظهار الرسالة */
        .show {
            display: block;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>فاتورة مبيعات</h1>
    </header>
    
    <div class="invoice">
        <h2>تفاصيل الطلبات</h2>
        <table id="ordersTable">
            <thead>
                <tr>
                    <th>اسم الطلب</th>
                    <th>العدد</th>
                    <th>السعر</th>
                    <th>الإجمالي</th>
                </tr>
            </thead>
            <tbody id="ordersTableBody">
                <!-- سيتم إضافة الطلبات هنا -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3">المجموع الكلي</td>
                    <td id="totalPrice">0 د.ع</td>
                </tr>
            </tfoot>
        </table>
    </div>
    
    <footer class="footer">
        <button onclick="showConfirmationPopup()">إرسال الطلبات</button>
        <button onclick="openRequestsPage()">إضافة طلبات</button>
    </footer>

    <!-- الرسائل المنبثقة -->
    <div id="confirmationPopup" class="popup">
        <h3>هل تريد إرسال الطلبات؟</h3>
        <button onclick="sendOrders()">نعم</button>
        <button onclick="closeConfirmationPopup()">لا</button>
    </div>

    <div id="finalPopup" class="popup">
        <h3>تم إرسال الطلبات بنجاح!</h3>
        <button onclick="closeFinalPopup()">إنهاء</button>
    </div>

    <div id="emptyPopup" class="popup">
        <h3>عذراً لا توجد طلبات لإرسالها. قم بإضافة طلبات أولاً.</h3>
        <button onclick="closeEmptyPopup()">موفق</button>
    </div>

    <script>
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const ordersTableBody = document.getElementById("ordersTableBody");
            let orderSummary = {};
            let totalPrice = 0;

            orders.forEach(order => {
                const orderPrice = parseFloat(order.price);
                if (orderSummary[order.name]) {
                    orderSummary[order.name].count += 1;
                    orderSummary[order.name].totalPrice += orderPrice;
                } else {
                    orderSummary[order.name] = {
                        price: orderPrice,
                        count: 1,
                        totalPrice: orderPrice
                    };
                }
            });

            for (let name in orderSummary) {
                const order = orderSummary[name];
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${order.count}</td>
                    <td>${order.price.toFixed(2)} د.ع</td>
                    <td>${(order.count * order.price).toFixed(2)} د.ع</td>
                `;
                ordersTableBody.appendChild(row);
                totalPrice += order.totalPrice;
            }

            document.getElementById("totalPrice").textContent = `${totalPrice.toFixed(2)} د.ع`;
        }

        function showConfirmationPopup() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            if (orders.length === 0) {
                document.getElementById('emptyPopup').classList.add('show');
            } else {
                document.getElementById('confirmationPopup').classList.add('show');
            }
        }

        function closeConfirmationPopup() {
            document.getElementById('confirmationPopup').classList.remove('show');
        }

        function sendOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            if (orders.length === 0) return; // لا تقم بأي إجراء إذا لم توجد طلبات

            const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            invoices.push(orders);

            localStorage.setItem('invoices', JSON.stringify(invoices));
            localStorage.setItem('orders', JSON.stringify([]));

            document.getElementById("ordersTableBody").innerHTML = '';
            document.getElementById("totalPrice").textContent = '0 د.ع';

            closeConfirmationPopup();
            document.getElementById('finalPopup').classList.add('show');
        }

        function closeFinalPopup() {
            document.getElementById('finalPopup').classList.remove('show');
        }

        function closeEmptyPopup() {
            document.getElementById('emptyPopup').classList.remove('show');
        }

        function openRequestsPage() {
            window.open("Requests.html", "_blank");
        }

        window.onload = loadOrders;
    </script>
</body>
</html>